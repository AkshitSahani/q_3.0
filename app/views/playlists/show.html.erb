<div id="d_player"></div>
<div id="dz-root"></div>
<script src="http://e-cdn-files.deezer.com/js/min/dz.js"></script>
<script>
  window.dzAsyncInit = function() {
  DZ.init({
    appId  : '226822',
    channelUrl : 'http://localhost:3000/playlist/player',
    player : {
      container: 'd_player',
      // width : 800, allow CSS to set 100% width
      height : 90,
      onload : function(){}
    }
  })
  };

var nextSongRecord = <%= @next_song_record %>

    if (<%= @next_song_id > 0 %>) {
      setTimeout(function(){DZ.player.playTracks([<%= @next_song_id %>])}, 3000);
      setTimeout(function(){DZ.Event.subscribe('track_end', function(){
        console.log("Track has ended");
        $.ajax({
          url: '/playlists/<%=params[:id]%>/update_song?song_id=' + nextSongRecord,
          method: 'get',
        }).done(function(data){
          DZ.player.playTracks([data['song_id']]);
          nextSongRecord = data['song_record'];
        })
      })}, 3000)};




  (function() {
  var e = document.createElement('script');
  e.src = 'http://e-cdn-files.deezer.com/js/min/dz.js';
  e.async = true;
  document.getElementById('dz-root').appendChild(e);
  }());
</script>

<div class="song-list">
<% @songs.each do |song| %>

<div class="song-in-queue"><%= song.name %>&nbsp
  <span class="right"><button type="button" name="button" class="upvote btn waves-effect waves-light blue darken-2"><i class="material-icons">thumb_up</i></button>&nbsp<button type="button" name="button" class="downvote  btn waves-effect waves-light red"><i class="material-icons">thumb_down</i></button>&nbsp
  <%= song.net_vote %></span> </div>
<% end %>
</div>
